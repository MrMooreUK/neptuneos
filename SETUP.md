# üåä NeptuneOS - Raspberry Pi Deployment Guide

This guide provides instructions for deploying NeptuneOS on a Raspberry Pi, turning it into a dedicated aquarium monitoring appliance.

## üöÄ Automated Installation (Recommended)

For the fastest setup, run this one-line command on your Raspberry Pi terminal. This will download and execute the installation script, which automates all the necessary steps.

```bash
curl -sL https://raw.githubusercontent.com/lovable-community/neptuneos/main/deploy/install.sh | sudo bash
```

> **Note:** The above URL is a placeholder. Please replace it with the actual raw file URL from your repository.

### What the script does:
- Updates and upgrades your Raspberry Pi OS.
- Installs necessary software: `git`, `nginx`, `nodejs`, `npm`, and `pm2`.
- Clones the NeptuneOS repository.
- Builds the React frontend for production.
- Configures `nginx` as a reverse proxy for the frontend, backend API, and camera stream.
- Sets up the backend API server (`express.js`) to run automatically on boot using `pm2`.
- Installs and configures `mjpg-streamer` for the camera feed and runs it as a service.
- Reboots the system to apply all changes.

After rebooting, you should be able to access the NeptuneOS dashboard by navigating to your Raspberry Pi's IP address in a web browser.

---

## üõ†Ô∏è Manual Installation Guide

If you prefer to set up the system manually, follow the steps below. This is based on the automated script but allows for more control.

### Prerequisites Checklist
- ‚úÖ **Node.js** v16 or higher ([Download](https://nodejs.org/))
- ‚úÖ **npm** or **yarn** package manager
- ‚úÖ **Git** for version control
- ‚úÖ **Modern browser** (Chrome, Firefox, Safari, Edge)

### 1Ô∏è‚É£ Clone & Install

```bash
# Clone the repository
# IMPORTANT: Replace with your actual repository URL
git clone https://github.com/lovable-community/neptuneos.git
cd neptuneos

# Install dependencies (for frontend and backend)
npm install
```

### 2Ô∏è‚É£ Environment Configuration
The automated script configures `nginx` to handle routing. The frontend is built with production settings, and the API and camera stream are exposed via `nginx` proxies. You do not need a `.env` file for this production setup, as API URLs are relative (`/api`, `/stream`).

### 3Ô∏è‚É£ Backend API Setup
The repository now includes a pre-configured Express.js API server in `deploy/api-server.js`.

To run it manually:
```bash
# Server will start on port 3001
node deploy/api-server.js
```

To manage it with PM2 (recommended for production):
```bash
# Install PM2 globally
sudo npm install pm2 -g

# Start the API server using the provided ecosystem config
pm2 start deploy/ecosystem.config.js

# Set it to start on boot
pm2 startup
# (run the command generated by pm2 startup)
pm2 save
```

### 4Ô∏è‚É£ Production Build
```bash
# Create optimized build of the frontend
npm run build
# Files will be in the 'dist' directory
```

### 5Ô∏è‚É£ Nginx & Camera Setup
The automated script handles this, but for manual setup:
1.  **Nginx:** Copy `deploy/nginx.conf` to `/etc/nginx/sites-available/neptuneos`, link it to `sites-enabled`, and restart `nginx`.
2.  **Camera:** Install `mjpg-streamer` and its dependencies. Copy `deploy/mjpg-streamer.service` to `/etc/systemd/system/`, then enable and start the service.

### 6Ô∏è‚É£ Start Development Server

```bash
# Start the development server
npm run dev
# or with yarn
yarn dev

# Server will start at http://localhost:5173
```

## üñ•Ô∏è Development Environment

### Recommended VS Code Extensions
- üîß **ES7+ React/Redux/React-Native snippets**
- üé® **Tailwind CSS IntelliSense**
- üìò **TypeScript Importer**
- üéØ **Auto Rename Tag**
- üîç **Bracket Pair Colorizer**
- üìù **Prettier - Code formatter**
- üßπ **ESLint**

### VS Code Settings
Add to your `.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "typescript.preferences.importModuleSpecifier": "relative",
  "emmet.includeLanguages": {
    "javascript": "javascriptreact"
  },
  "tailwindCSS.experimental.classRegex": [
    ["cn\\(([^)]*)\\)", "'([^']*)'"]
  ]
}
```

## üîß Hardware Setup

### üå°Ô∏è Temperature Sensors

#### DS18B20 Sensors (Recommended)
```bash
# Raspberry Pi GPIO pins
Sensor 1: GPIO 4 (Pin 7)
Sensor 2: GPIO 17 (Pin 11)
Power: 3.3V (Pin 1)
Ground: Ground (Pin 6)
```

#### Wiring Diagram
```
DS18B20 Sensor
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1  2  3     ‚îÇ  1: Ground (Black)
‚îÇ ‚îÇ  ‚îÇ  ‚îÇ     ‚îÇ  2: Data (Yellow)
‚îÇ ‚îÇ  ‚îÇ  ‚îÇ     ‚îÇ  3: Power (Red)
‚îî‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ  ‚îÇ  ‚îÇ
  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ 3.3V (Pin 1)
  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GPIO 4 (Pin 7) + 4.7kŒ© pullup resistor
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Ground (Pin 6)
```

#### Enable 1-Wire Interface
```bash
# Edit Raspberry Pi config
sudo nano /boot/config.txt

# Add this line
dtoverlay=w1-gpio

# Reboot
sudo reboot

# Verify sensors
cat /sys/bus/w1/devices/*/w1_slave
```

### üìπ Camera Setup

#### USB Camera
```bash
# List available cameras
lsusb | grep -i camera

# Test camera
cheese  # GUI camera test
# or
ffplay /dev/video0  # Command line test
```

#### Raspberry Pi Camera
```bash
# Enable camera interface
sudo raspi-config
# Navigate to Interface Options > Camera > Enable

# Test camera
raspistill -o test.jpg  # Take photo
raspivid -t 10000 -o test.h264  # Record video
```

#### Streaming Setup
```bash
# Install mjpg-streamer
sudo apt update
sudo apt install cmake libjpeg-dev

git clone https://github.com/jacksonliam/mjpg-streamer.git
cd mjpg-streamer/mjpg-streamer-experimental
make
sudo make install

# Start streaming
mjpg_streamer -i "input_uvc.so -d /dev/video0 -r 1280x720 -f 30" -o "output_http.so -p 8080 -w ./www"
```

## üåê Network Configuration

### WiFi Setup
```bash
# Configure WiFi on Raspberry Pi
sudo nano /etc/wpa_supplicant/wpa_supplicant.conf

# Add network configuration
network={
    ssid="YourNetworkName"
    psk="YourPassword"
}

# Apply changes
sudo systemctl restart networking
```

### Static IP Configuration
```bash
# Edit DHCP configuration
sudo nano /etc/dhcpcd.conf

# Add static IP configuration
interface wlan0
static ip_address=192.168.1.100/24
static routers=192.168.1.1
static domain_name_servers=192.168.1.1 8.8.8.8
```

### Firewall Rules
```bash
# Allow HTTP traffic
sudo ufw allow 80
sudo ufw allow 443

# Allow camera stream
sudo ufw allow 8080

# Allow API access
sudo ufw allow 3001

# Enable firewall
sudo ufw enable
```

## üñ•Ô∏è Backend API Setup

### Express.js Server Example
```javascript
// server.js
const express = require('express');
const cors = require('cors');
const fs = require('fs');

const app = express();
const PORT = 3001;

app.use(cors());
app.use(express.json());

// Temperature endpoint
app.get('/api/temperature', (req, res) => {
  try {
    // Read DS18B20 sensors
    const sensor1Path = '/sys/bus/w1/devices/28-xxxxxxxxxxxx/w1_slave';
    const sensor2Path = '/sys/bus/w1/devices/28-yyyyyyyyyyyy/w1_slave';
    
    const temp1 = readTemperature(sensor1Path);
    const temp2 = readTemperature(sensor2Path);
    const average = (temp1 + temp2) / 2;
    
    res.json({
      sensor1: temp1,
      sensor2: temp2,
      average: average,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    res.status(500).json({ error: 'Failed to read sensors' });
  }
});

function readTemperature(sensorPath) {
  const data = fs.readFileSync(sensorPath, 'utf8');
  const tempMatch = data.match(/t=(-?\d+)/);
  return tempMatch ? parseInt(tempMatch[1]) / 1000 : null;
}

app.listen(PORT, () => {
  console.log(`üåä NeptuneOS API running on port ${PORT}`);
});
```

### Systemd Service
```bash
# Create service file
sudo nano /etc/systemd/system/neptuneos-api.service
```

```ini
[Unit]
Description=NeptuneOS API Server
After=network.target

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/neptuneos-api
ExecStart=/usr/bin/node server.js
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# Enable and start service
sudo systemctl enable neptuneos-api
sudo systemctl start neptuneos-api
sudo systemctl status neptuneos-api
```

## üöÄ Production Deployment

### Build for Production
```bash
# Create optimized build
npm run build
# or
yarn build

# Files will be in the 'dist' directory
```

### Nginx Configuration
```nginx
# /etc/nginx/sites-available/neptuneos
server {
    listen 80;
    server_name your-domain.com;
    
    root /var/www/neptuneos/dist;
    index index.html;
    
    # Handle React Router
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # API proxy
    location /api/ {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
    
    # Camera stream proxy
    location /stream {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### SSL Certificate (Let's Encrypt)
```bash
# Install Certbot
sudo apt install certbot python3-certbot-nginx

# Obtain certificate
sudo certbot --nginx -d your-domain.com

# Auto-renewal
sudo crontab -e
# Add: 0 12 * * * /usr/bin/certbot renew --quiet
```

## üîß Troubleshooting

### Common Issues

#### üå°Ô∏è Temperature Sensors Not Detected
```bash
# Check 1-wire interface
lsmod | grep w1
# Should show: w1_gpio, w1_therm

# Check device tree
ls /sys/bus/w1/devices/
# Should show sensor IDs like 28-xxxxxxxxxxxx

# Check sensor data
cat /sys/bus/w1/devices/28-*/w1_slave
# Should show temperature data
```

#### üìπ Camera Not Working
```bash
# Check camera connection
lsusb | grep -i camera
v4l2-ctl --list-devices

# Check permissions
sudo usermod -a -G video $USER
# Logout and login again

# Test camera
cheese  # GUI test
ffplay /dev/video0  # Command line test
```

#### üåê Network Issues
```bash
# Check network status
ip addr show
iwconfig  # WiFi status

# Test connectivity
ping google.com
curl -I http://localhost:3001/api/temperature

# Check firewall
sudo ufw status
```

#### üíª Build Errors
```bash
# Clear cache and reinstall
rm -rf node_modules package-lock.json
npm install

# Update dependencies
npm update

# Check Node.js version
node --version  # Should be v16+
```

### Performance Optimization

#### Memory Usage
```bash
# Monitor memory
free -h
top -p $(pgrep node)

# Increase swap (if needed)
sudo fallocate -l 1G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

#### CPU Usage
```bash
# Monitor CPU
htop
iostat 1

# Optimize Node.js
export NODE_OPTIONS="--max-old-space-size=512"
```

## üìû Support & Resources

### Getting Help
- üìö **Documentation**: [Lovable Docs](https://docs.lovable.dev/)
- üí¨ **Discord**: [Community Support](https://discord.com/channels/1119885301872070706/1280461670979993613)
- üé• **Tutorials**: [YouTube Playlist](https://www.youtube.com/watch?v=9KHLTZaJcR8&list=PLbVHz4urQBZkJiAWdG8HWoJTdgEysigIO)
- üêõ **Issues**: GitHub Issues section

### Useful Commands
```bash
# System information
uname -a                    # System info
cat /proc/cpuinfo          # CPU info
cat /proc/meminfo          # Memory info
df -h                      # Disk usage
vcgencmd measure_temp      # Pi temperature

# Service management
sudo systemctl status service-name
sudo systemctl restart service-name
sudo journalctl -f -u service-name

# Network debugging
netstat -tlnp              # Open ports
ss -tulpn                  # Socket statistics
nmap localhost             # Port scan
```

---

üéâ **Congratulations!** You should now have NeptuneOS running successfully. If you encounter any issues, refer to the troubleshooting section or reach out to the community for support.
